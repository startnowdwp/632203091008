<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <style>
        /* 复用选项卡样式 */
        .tab { overflow: hidden; border: 1px solid #ccc; background: #f1f1f1 }
        .tab button { 
            padding: 14px 16px; 
            font-size: 17px;
            position: relative;
            transition: all 0.3s ease;
            margin-right: 5px;
        }
        .tab button:not(:last-child):after {
            content: "→";
            position: absolute;
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            color: #2c3e50;
            font-weight: bold;
        }
        .tab button.active {
            background-color: #2c3e50;
            color: white;
            font-weight: bold;
        }
        .tab button:hover {
            background-color: #ddd;
        }
        .tabcontent { display: none; padding: 20px }
        table { width: 100%; border-collapse: collapse }
        th, td { border: 1px solid #ddd; padding: 12px }
        th { background-color: #2c3e50; color: white }
        .scroll-table { overflow-x: auto }
        .formula { background: #f8f9fa; padding: 15px; margin: 15px 0 }
    </style>
</head>
<body>
    <div class="tab">
        <button class="tablinks" onclick="openTab(event, 'Data')">① 数据整理</button>
        <button class="tablinks" onclick="openTab(event, 'Weight')">② 熵权法赋权</button>
        <button class="tablinks" onclick="openTab(event, 'RSR')">③ RSR分布</button>
        <button class="tablinks" onclick="openTab(event, 'Regression')">④ 回归分档</button>
        <button class="tablinks" onclick="openTab(event, 'Map')">⑤ 地图可视化</button>
    </div>

    <!-- 数据整理 -->
    <div id="Data" class="tabcontent">
        <h3>POI分类标准</h3>
        <p>采用秩和比综合评价法（RSR）对304公交线路各站点进行多维度评估。数据源涵盖平峰与高峰时段的上下车客流、轨道接驳属性、公交线路覆盖数量，以及站点300米半径范围内的住宅、商业、文化三类POI数量，POI分类关键词根据下表规定。</p>
        <table>
            <tr><th>POI类型</th><th>包含关键词</th></tr>
            <tr><td>商业</td><td>购物, 超市, 便利店, 商铺, 美食, 餐厅, 中餐厅, 小吃快餐店 酒店, 快捷酒店, 公司, 维修点, 宠物服务, 丽人, 美发, 生活服务家居建材, 公司企业, 家居, 维修</td></tr>
            <tr><td>住宅</td><td>住宅区, 房地产, 住宅, 小区, 内部楼栋, 住宅楼</td></tr>
            <tr><td>文化</td><td>教育培训, 培训机构, 公园, 旅游景点, 文化, 游戏场所, 公检法机构, 政府机构, 学校, 景点, 文化馆, 体育</td></tr>
        </table>

        <h3>数据说明</h3>
        <p>平峰站点上下车客流采用了4.11调查数据中的上行客流量数据；高峰站点上下车客流采用3.31调查数据中的下行客流量数据，因其调查时段处于17：40-18：40，更符合晚高峰时段的定义；是否为轨道接驳站点指标是一个二元分类数据，数据来源：https://www.cqgj.net/index/index/；覆盖公交线路数量是指在该站点设置停靠的线路数量总和，数据来源：https://chongqing.8684.cn/x_adde86f7。</p>
        <div class="scroll-table">
            <table style="min-width: 1200px">
                <tr><th>站点名称</th><th>平峰站点上下车客流</th><th>高峰站点上下车客流</th><th>是否为轨道接驳站点</th><th>覆盖公交线路数量</th><th>站点300m半径内住宅P0I数量</th><th>站点300m半径内商业P0I数量</th><th>站点300m半径内文化P0I数量</th></tr>
                <tr><td>南坪（东路）</td><td>22</td><td>9</td><td>1</td><td>27</td><td>31</td><td>594</td><td>29</td></tr>
                <tr><td>万寿站</td><td>30</td><td>0</td><td>1</td><td>12</td><td>63</td><td>701</td><td>33</td></tr>
                <tr><td>二小区</td><td>10</td><td>0</td><td>1</td><td>10</td><td>45</td><td>788</td><td>18</td></tr>
                <tr><td>南坪东路女子医院</td><td>7</td><td>0</td><td>0</td><td>9</td><td>35</td><td>261</td><td>27</td></tr>
                <tr><td>福利社（小米熊儿童医院）</td><td>5</td><td>10</td><td>0</td><td>8</td><td>41</td><td>164</td><td>13</td></tr>

                <tr><td>海棠晓月</td><td>4</td><td>8</td><td>0</td><td>10</td><td>28</td><td>126</td><td>14</td></tr>
                <tr><td>海棠溪</td><td>4</td><td>5</td><td>0</td><td>10</td><td>17</td><td>216</td><td>17</td></tr>
                <tr><td>海棠溪新街</td><td>2</td><td>5</td><td>1</td><td>10</td><td>5</td><td>103</td><td>11</td></tr>
                <tr><td>上新街</td><td>2</td><td>3</td><td>1</td><td>8</td><td>31</td><td>136</td><td>11</td></tr>
                <tr><td>龙门浩</td><td>0</td><td>7</td><td>0</td><td>4</td><td>9</td><td>79</td><td>13</td></tr>
                <tr><td>上新街[轨道站]（一天门）</td><td>9</td><td>12</td><td>1</td><td>4</td><td>7</td><td>21</td><td>5</td></tr>
                <tr><td>下浩</td><td>0</td><td>0</td><td>0</td><td>4</td><td>3</td><td>15</td><td>3</td></tr>
                <tr><td>觉林寺</td><td>2</td><td>1</td><td>0</td><td>4</td><td>0</td><td>1</td><td>0</td></tr>
                <tr><td>涂山路中段（莲花公墓）</td><td>0</td><td>2</td><td>1</td><td>3</td><td>0</td><td>29</td><td>4</td></tr>
                <tr><td>市五医院</td><td>0</td><td>6</td><td>0</td><td>4</td><td>4</td><td>88</td><td>10</td></tr>
                <tr><td>涂山路</td><td>0</td><td>2</td><td>0</td><td>3</td><td>9</td><td>81</td><td>10</td></tr>
                <tr><td>涂山站[东海长洲]</td><td>3</td><td>6</td><td>1</td><td>4</td><td>10</td><td>96</td><td>8</td></tr>
                <tr><td>南岸大石坝</td><td>5</td><td>2</td><td>1</td><td>4</td><td>13</td><td>119</td><td>7</td></tr>
                <tr><td>十一中</td><td>5</td><td>7</td><td>0</td><td>5</td><td>35</td><td>96</td><td>12</td></tr>
                <tr><td>腾龙大道</td><td>1</td><td>0</td><td>1</td><td>4</td><td>3</td><td>25</td><td>3</td></tr>
                <tr><td>开泰路首末站</td><td>7</td><td>2</td><td>0</td><td>1</td><td>25</td><td>134</td><td>6</td></tr>
            </table>
        </div>
    </div>

    <!-- 熵权法赋权 -->
    <div id="Weight" class="tabcontent">
        <h3>指标权重分配</h3>
        <p>基于熵权法的权重计算结果见下表，分析显示，各指标对站点综合效益的影响差异显著。其中，“是否为轨道接驳站点”权重最高（21.976%），凸显了轨道交通衔接在公交站点效能中的核心作用；平峰与高峰客流指标分别贡献19.85%和13.37%的权重，反映时段客流均衡性的重要性；商业POI密度（16.43%）和住宅POI密度（11.72%）对站点活力具有较强解释力，而文化POI权重最低（7.29%），表明其对站点评价影响相对有限。熵权法结果符合城市公交站点“客流主导、用地协同”的典型特征。</p>
        <table>
            <tr><th>评价指标</th><th>信息熵值e</th><th>信息效用值d</th><th>权重(%)</th></tr>
            <tr><td>平峰站点上下车客流</td><td>0.78</td><td>0.22</td><td>19.85</td></tr>
            <tr><td>高峰站点上下车客流</td><td>0.852</td><td>0.148</td><td>13.371</td></tr>
            <tr><td>是否为轨道接驳站点</td><td>0.756</td><td>0.244</td><td>21.976</td></tr>
            <tr><td>覆盖公交线路数量</td><td>0.896</td><td>0.104</td><td>9.374</td></tr>
            <tr><td>站点300m半径内住宅POI数量</td><td>0.87</td><td>0.13</td><td>11.715</td></tr>
            <tr><td>站点300m半径内商业POI数量</td><td>0.818</td><td>0.182</td><td>16.427</td></tr>
            <tr><td>站点300m半径内文化POI数量</td><td>0.919</td><td>0.081</td><td>7.287</td></tr>
        </table>
    </div>

    <!-- RSR分布 -->
    <div id="RSR" class="tabcontent">
        <h3>非整秩法计算结果</h3>
        <p>相比整秩法，该方法能更精确地反映指标值的相对差异。从而克服了 RSR 法秩次化时易损失原指标值定量信息的缺点。例如“高峰站点上下车客流”指标中，最大值（万寿站）赋秩21，最小值（下浩站）赋秩1，中间值按比例插值，避免整秩法的信息损失。轨道接驳属性（二元变量）直接以21（是）或1（否）赋秩，强化枢纽站点的区分度。通过非整秩法构建秩矩阵（见附录表 ）后，计算得到各站点RSR值及其概率单位（Probit），见附录表 。结果显示，南坪（东路）站以RSR值0.769排名首位，其高峰客流秩次（R2=16）与轨道接驳属性（R3=21）表现突出；万寿站因平峰客流（R1=21）和商业POI（R6=18.79）优势位列第二；而下浩站因所有指标秩次均处于末位（如R5=1.95），RSR值仅为0.072，排名垫底。RSR分布表进一步揭示了站点效能的梯度差异，Probit值跨度从3.33（下浩站）至7.26（南坪站），符合右偏态分布特征。</p>
        <div class="scroll-table">
            <table style="min-width: 800px">
                <tr><th>站点名称</th><th>排名</th><th>Probit值</th><th>RSR拟合值</th></tr>
                <tr><td>南坪（东路）</td><td>1</td><td>7.260188991329377</td><td>0.7692681704873968</td></tr>
                <tr><td>万寿站</td><td>2</td><td>6.668391193947079</td><td>0.6524149090400396</td></tr>
                <tr><td>上新街[轨道站]（一天门）</td><td>4</td><td>6.067570523878141</td><td>0.5337800388984261</td></tr>
                <tr><td>二小区</td><td>3</td><td>6.309171716785777</td><td>0.581485331965936</td></tr>
                <tr><td>南坪东路女子医院</td><td>13</td><td>4.819987630207295</td><td>0.28743892256406767</td></tr>
                <tr><td>福利社</td><td>9</td><td>5.302980448056206</td><td>0.3828081285174233</td></tr>
                <tr><td>腾龙大道</td><td>12</td><td>4.940282900214677</td><td>0.31119179001175157</td></tr>
                <tr><td>十一中</td><td>14</td><td>4.697019551943794</td><td>0.2631582965418632</td></tr>
                <tr><td>南岸大石坝</td><td>8</td><td>5.430727299295458</td><td>0.4080323457635272</td></tr>
                <tr><td>涂山站[东海长洲]</td><td>7</td><td>5.565948821932863</td><td>0.43473247207009924</td></tr>
                <tr><td>市五医院</td><td>18</td><td>4.123857150753159</td><td>0.14998468181335456</td></tr>
                <tr><td>涂山路中段（莲花公墓）</td><td>10</td><td>5.1800123697927045</td><td>0.3585275024952187</td></tr>
                <tr><td>开泰路首末站</td><td>16</td><td>4.434051178067137</td><td>0.21123395298918723</td></tr>
                <tr><td>龙门浩</td><td>17</td><td>4.287556967610511</td><td>0.18230798139765403</td></tr>
                <tr><td>上新街</td><td>5</td><td>5.876142849246841</td><td>0.4959817432459318</td></tr>
                <tr><td>海棠溪新街</td><td>6</td><td>5.712443032389489</td><td>0.46365844366163234</td></tr>
                <tr><td>海棠溪</td><td>15</td><td>4.569272700704542</td><td>0.23793407929575916</td></tr>
                <tr><td>海棠晓月</td><td>11</td><td>5.059717099785323</td><td>0.3347746350475348</td></tr>
                <tr><td>下浩</td><td>21</td><td>3.3316088060529205</td><td>-0.006448484</td></tr>
                <tr><td>涂山路</td><td>19</td><td>3.9324294761218583</td><td>0.11218638616086019</td></tr>
                <tr><td>觉林寺</td><td>20</td><td>3.690828283214223</td><td>0.06448109309335048</td></tr>
            </table>
        </div>
    </div>
    <div id="Regression" class="tabcontent">
        <h3>线性回归分析</h3>
        <p>以Probit值为自变量、RSR值为因变量进行线性回归分析，结果如下表所示：</p>
        <div class="scroll-table">
            <table style="min-width: 800px">
                <tr>
                    <th></th>
                    <th colspan="2">非标准化系数</th>
                    <th>标准化系数</th>
                    <th>t</th>
                    <th>P</th>
                    <th>VIF</th>
                    <th>R²</th>
                    <th>调整R²</th>
                    <th>F</th>
                </tr>
                <tr>
                    <td></td>
                    <td>B</td>
                    <td>标准误</td>
                    <td>Beta</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>常数</td>
                    <td>-0.664</td>
                    <td>0.063</td>
                    <td>-</td>
                    <td>-10.608</td>
                    <td>0.000***</td>
                    <td>-</td>
                    <td>0.934</td>
                    <td>0.931</td>
                    <td>F=268.847 P=0.000***</td>
                </tr>
                <tr>
                    <td>Probit</td>
                    <td>0.197</td>
                    <td>0.012</td>
                    <td>0.966</td>
                    <td>16.397</td>
                    <td>0.000***</td>
                    <td>1</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </table>
        </div>
        <p style="font-size: 0.9em; margin-top: 5px;">注：***、**、*分别代表1%、5%、10%的显著性水平</p>
        
        <!-- 添加线性回归拟合图 -->
        <div style="text-align: center; margin: 20px 0;">
            <figure>
                <img src="images\线性回归拟合.png" alt="线性回归拟合图" style="max-width: 90%; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                <figcaption style="margin-top: 10px; font-style: italic; color: #555;">Probit值与RSR值的线性回归拟合曲线</figcaption>
            </figure>
        </div>
        
        <h3>分档分析</h3>
        <p>以Probit值为自变量、RSR值为因变量的线性回归结果见下表，拟合合优度（R²=0.934）显著，拟合曲线如下图，回归方程RSR=-0.664+0.197×Probit通过F检验，且VIF值均小于5，模型无多重共线性问题。根据分档临界值（表5）划分，划分结果如表6：第3档（高效站点）包括南坪（东路）、万寿站等4个站点，其RSR拟合值均超过0.52，具备高客流与强轨道接驳双重优势；第2档（中效站点）占多数（如南坪东路女子医院、福利社站等），RSR值介于0.13-0.52之间；第1档（低效站点）包含下浩、涂山路和觉林寺三站，其RSR值低于0.1255，与客流稀疏、无接驳功能的现状一致。分档结果与前期满载率分析结论相互印证，为站点优化提供量化依据。</p>
        <table>
            <tr><th>分档</th><th>RSR范围</th><th>站点数量</th><th>站点列表</th></tr>
            <tr><td>高效站点</td><td>&gt;0.52</td><td>4</td><td>南坪（东路）、万寿站、上新街[轨道站]（一天门）、二小区</td></tr>
            <tr><td>中效站点</td><td>0.13-0.52</td><td>14</td><td>南坪东路女子医院、福利社、腾龙大道、十一中、南岸大石坝、涂山站[东海长洲]、市五医院、涂山路中段（莲花公墓）、开泰路首末站、龙门浩、上新街、海棠溪新街、海棠溪、海棠晓月</td></tr>
            <tr><td>低效站点</td><td>&lt;0.13</td><td>3</td><td>下浩、涂山路、觉林寺</td></tr>
        </table>
    </div>

    <script>
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }
        // 默认打开第一个标签页
        document.getElementsByClassName('tablinks')[0].click();
    </script>

    <!-- 在分档分析后添加地图可视化标签页 -->
    <div id="Map" class="tabcontent">
        <h3>304公交线路站点分级可视化(点击站点可查看详细信息)</h3>
        <p>下图展示了304公交线路的站点分布及其效能等级。高效站点（红色）主要集中在南坪商圈及轨道接驳点，中效站点（黄色）沿线分布，低效站点（蓝色）多位于线路末端。</p>
        
        <!-- 移除静态地图概览 -->
        
        <div id="mapContainer" style="width: 100%; height: 600px; border: 1px solid #ccc; margin-bottom: 20px;"></div>
        
        <!-- 美化站点信息显示区域 -->
        <div id="stationInfo" style="padding: 15px; background: #f5f5f5; border-radius: 5px; display: none; box-shadow: 0 3px 10px rgba(0,0,0,0.2); margin-top: 20px; border: 1px solid #ddd;">
            <h4 id="stationName" style="margin-top: 0; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 8px;">站点信息</h4>
            <table id="stationData" style="width: 100%; background: white; margin-top: 10px;">
                <tr>
                    <th style="background: #2c3e50; color: white;">指标</th>
                    <th style="background: #2c3e50; color: white;">数值</th>
                </tr>
            </table>
        </div>
        
        <!-- 替换百度地图API为高德地图API -->
        <script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&key=865dbe7253fdd8c89f5c914ad355afac"></script>
        <script>
            // 在地图标签页被激活时初始化地图
            document.querySelector('button[onclick="openTab(event, \'Map\')"]').addEventListener('click', initMap);
            
            function initMap() {
                // 如果地图已经初始化，则不再重复初始化
                if (window.mapInitialized) return;
                window.mapInitialized = true;
                
                // 创建地图实例
                var map = new AMap.Map("mapContainer", {
                    // 设置中心点为重庆南坪
                    center: [106.570768, 29.52911],
                    zoom: 14,
                    viewMode: '3D'
                });
                
                // 添加控件
                map.plugin(['AMap.ToolBar', 'AMap.Scale'], function(){
                    map.addControl(new AMap.ToolBar());
                    map.addControl(new AMap.Scale());
                });
                
                // 站点数据（使用实际坐标）
                var stations = [
                    // 高效站点（3级）
                    {name: "南坪站", level: 3, position: [106.570768, 29.52911], 
                     data: {平峰站点上下车客流: 22, 高峰站点上下车客流: 9, 是否为轨道接驳站点: "是", 覆盖公交线路数量: 27, 站点300m半径内住宅P0I数量: 31, 站点300m半径内商业P0I数量: 594, 站点300m半径内文化P0I数量: 29, RSR值: 0.769, Probit值: 7.26}},
                    {name: "万寿路", level: 3, position: [106.561636, 29.527], 
                     data: {平峰站点上下车客流: 30, 高峰站点上下车客流: 0, 是否为轨道接驳站点: "是", 覆盖公交线路数量: 12, 站点300m半径内住宅P0I数量: 63, 站点300m半径内商业P0I数量: 701, 站点300m半径内文化P0I数量: 33, RSR值: 0.652, Probit值: 6.67}},
                    {name: "一天门", level: 3, position: [106.597897, 29.557139], 
                     data: {平峰站点上下车客流: 9, 高峰站点上下车客流: 12, 是否为轨道接驳站点: "是", 覆盖公交线路数量: 4, 站点300m半径内住宅P0I数量: 7, 站点300m半径内商业P0I数量: 21, 站点300m半径内文化P0I数量: 5, RSR值: 0.534, Probit值: 6.07}},
                    {name: "二小区", level: 3, position: [106.568474, 29.523325], 
                     data: {平峰站点上下车客流: 10, 高峰站点上下车客流: 0, 是否为轨道接驳站点: "是", 覆盖公交线路数量: 10, 站点300m半径内住宅P0I数量: 45, 站点300m半径内商业P0I数量: 788, 站点300m半径内文化P0I数量: 18, RSR值: 0.581, Probit值: 6.31}},
                    
                    // 中效站点（2级）
                    {name: "南坪东路", level: 2, position: [106.574042, 29.530158], 
                     data: {平峰站点上下车客流: 7, 高峰站点上下车客流: 0, 是否为轨道接驳站点: "否", 覆盖公交线路数量: 9, 站点300m半径内住宅P0I数量: 35, 站点300m半径内商业P0I数量: 261, 站点300m半径内文化P0I数量: 27, RSR值: 0.287, Probit值: 4.82}},
                    {name: "福利社·小米熊儿童医院", level: 2, position: [106.577997, 29.53578], 
                     data: {平峰站点上下车客流: 5, 高峰站点上下车客流: 10, 是否为轨道接驳站点: "否", 覆盖公交线路数量: 8, 站点300m半径内住宅P0I数量: 41, 站点300m半径内商业P0I数量: 164, 站点300m半径内文化P0I数量: 13, RSR值: 0.383, Probit值: 5.30}},
                    {name: "腾龙大道", level: 2, position: [106.594589, 29.587336], 
                     data: {平峰站点上下车客流: 1, 高峰站点上下车客流: 0, 是否为轨道接驳站点: "是", 覆盖公交线路数量: 4, 站点300m半径内住宅P0I数量: 3, 站点300m半径内商业P0I数量: 25, 站点300m半径内文化P0I数量: 3, RSR值: 0.311, Probit值: 4.94}},
                    {name: "十一中", level: 2, position: [106.59634, 29.579789], 
                     data: {平峰站点上下车客流: 5, 高峰站点上下车客流: 7, 是否为轨道接驳站点: "否", 覆盖公交线路数量: 5, 站点300m半径内住宅P0I数量: 35, 站点300m半径内商业P0I数量: 96, 站点300m半径内文化P0I数量: 12, RSR值: 0.263, Probit值: 4.70}},
                    {name: "南岸大石坝", level: 2, position: [106.600166, 29.576859], 
                     data: {平峰站点上下车客流: 5, 高峰站点上下车客流: 2, 是否为轨道接驳站点: "是", 覆盖公交线路数量: 4, 站点300m半径内住宅P0I数量: 13, 站点300m半径内商业P0I数量: 119, 站点300m半径内文化P0I数量: 7, RSR值: 0.408, Probit值: 5.43}},
                    {name: "东海长洲", level: 2, position: [106.601541, 29.574497], 
                     data: {平峰站点上下车客流: 3, 高峰站点上下车客流: 6, 是否为轨道接驳站点: "是", 覆盖公交线路数量: 4, 站点300m半径内住宅P0I数量: 10, 站点300m半径内商业P0I数量: 96, 站点300m半径内文化P0I数量: 8, RSR值: 0.435, Probit值: 5.57}},
                    {name: "五院", level: 2, position: [106.600815, 29.569458], 
                     data: {平峰站点上下车客流: 0, 高峰站点上下车客流: 6, 是否为轨道接驳站点: "否", 覆盖公交线路数量: 4, 站点300m半径内住宅P0I数量: 4, 站点300m半径内商业P0I数量: 88, 站点300m半径内文化P0I数量: 10, RSR值: 0.150, Probit值: 4.12}},
                    {name: "涂山路中段", level: 2, position: [106.601571, 29.565942], 
                     data: {平峰站点上下车客流: 0, 高峰站点上下车客流: 2, 是否为轨道接驳站点: "是", 覆盖公交线路数量: 3, 站点300m半径内住宅P0I数量: 0, 站点300m半径内商业P0I数量: 29, 站点300m半径内文化P0I数量: 4, RSR值: 0.359, Probit值: 5.18}},
                    {name: "开泰路首末站", level: 2, position: [106.596319, 29.590661], 
                     data: {平峰站点上下车客流: 7, 高峰站点上下车客流: 2, 是否为轨道接驳站点: "否", 覆盖公交线路数量: 1, 站点300m半径内住宅P0I数量: 25, 站点300m半径内商业P0I数量: 134, 站点300m半径内文化P0I数量: 6, RSR值: 0.211, Probit值: 4.43}},
                    {name: "龙门浩", level: 2, position: [106.59572, 29.552882], 
                     data: {平峰站点上下车客流: 0, 高峰站点上下车客流: 7, 是否为轨道接驳站点: "否", 覆盖公交线路数量: 4, 站点300m半径内住宅P0I数量: 9, 站点300m半径内商业P0I数量: 79, 站点300m半径内文化P0I数量: 13, RSR值: 0.182, Probit值: 4.29}},
                    {name: "上新街", level: 2, position: [106.594927, 29.549323], 
                     data: {平峰站点上下车客流: 2, 高峰站点上下车客流: 3, 是否为轨道接驳站点: "是", 覆盖公交线路数量: 8, 站点300m半径内住宅P0I数量: 31, 站点300m半径内商业P0I数量: 136, 站点300m半径内文化P0I数量: 11, RSR值: 0.496, Probit值: 5.88}},
                    {name: "海棠溪新街", level: 2, position: [106.59207, 29.544583], 
                     data: {平峰站点上下车客流: 2, 高峰站点上下车客流: 5, 是否为轨道接驳站点: "是", 覆盖公交线路数量: 10, 站点300m半径内住宅P0I数量: 5, 站点300m半径内商业P0I数量: 103, 站点300m半径内文化P0I数量: 11, RSR值: 0.464, Probit值: 5.71}},
                    {name: "海棠溪", level: 2, position: [106.588536, 29.542803], 
                     data: {平峰站点上下车客流: 4, 高峰站点上下车客流: 5, 是否为轨道接驳站点: "否", 覆盖公交线路数量: 10, 站点300m半径内住宅P0I数量: 17, 站点300m半径内商业P0I数量: 216, 站点300m半径内文化P0I数量: 17, RSR值: 0.238, Probit值: 4.57}},
                    {name: "海棠晓月", level: 2, position: [106.583622, 29.53866], 
                     data: {平峰站点上下车客流: 4, 高峰站点上下车客流: 8, 是否为轨道接驳站点: "否", 覆盖公交线路数量: 10, 站点300m半径内住宅P0I数量: 28, 站点300m半径内商业P0I数量: 126, 站点300m半径内文化P0I数量: 14, RSR值: 0.335, Probit值: 5.06}},
                    
                    // 低效站点（1级）
                    {name: "下浩", level: 1, position: [106.59861, 29.559345], 
                     data: {平峰站点上下车客流: 0, 高峰站点上下车客流: 0, 是否为轨道接驳站点: "否", 覆盖公交线路数量: 4, 站点300m半径内住宅P0I数量: 3, 站点300m半径内商业P0I数量: 15, 站点300m半径内文化P0I数量: 3, RSR值: -0.006, Probit值: 3.33}},
                    {name: "涂山路", level: 1, position: [106.60105, 29.573168], 
                     data: {平峰站点上下车客流: 0, 高峰站点上下车客流: 2, 是否为轨道接驳站点: "否", 覆盖公交线路数量: 3, 站点300m半径内住宅P0I数量: 9, 站点300m半径内商业P0I数量: 81, 站点300m半径内文化P0I数量: 10, RSR值: 0.112, Probit值: 3.93}},
                    {name: "觉林寺", level: 1, position: [106.599379, 29.561237], 
                     data: {平峰站点上下车客流: 2, 高峰站点上下车客流: 1, 是否为轨道接驳站点: "否", 覆盖公交线路数量: 4, 站点300m半径内住宅P0I数量: 0, 站点300m半径内商业P0I数量: 1, 站点300m半径内文化P0I数量: 0, RSR值: 0.064, Probit值: 3.69}}
                ];
                
                // 使用真实轨迹数据替代直线连接
                // 上行线路真实轨迹坐标点
                var upLineCoords = [
                    [29.529111,106.570767],[29.529104,106.570708],[29.529077,106.570467],[29.529055,106.570284],[29.529045,106.570166],[29.529028,106.570021],[29.528986,106.569641],[29.528964,106.569464],[29.528948,106.569335],[29.528932,106.569222],[29.528803,106.568385],[29.528707,106.568015],[29.528685,106.567806],[29.528637,106.567382],[29.528599,106.567093],[29.528524,106.566395],[29.528497,106.566148],[29.52839,106.565526],[29.528363,106.56529],[29.528342,106.564958],[29.528342,106.564673],[29.528353,106.5644],[29.528353,106.564314],[29.528347,106.563885],[29.528342,106.563718],[29.528342,106.563461],[29.528342,106.563353],[29.52832,106.562903],[29.52832,106.562763],[29.528315,106.562452],[29.52832,106.561884],[29.52832,106.561884],[29.528267,106.561744],[29.528149,106.561599],[29.5278,106.56161],[29.52736,106.561626],[29.527024,106.561636],[29.527024,106.561636],[29.527006,106.561637],[29.526754,106.561642],[29.526658,106.561642],[29.525923,106.561658],[29.525483,106.561653],[29.525327,106.561648],[29.525273,106.561648],[29.525166,106.561642],[29.524941,106.561642],[29.524716,106.561642],[29.524667,106.561642],[29.524361,106.561642],[29.524125,106.561653],[29.523948,106.561664],[29.523906,106.561669],[29.523648,106.561691],[29.52324,106.56168],[29.52324,106.56168],[29.523251,106.562404],[29.523262,106.563595],[29.523273,106.564223],[29.523278,106.564432],[29.523278,106.564464],[29.523294,106.565692],[29.523294,106.565891],[29.523305,106.566293],[29.523305,106.56639],[29.523321,106.567382],[29.523321,106.567388],[29.523321,106.567452],[29.523321,106.567516],[29.523321,106.568251],[29.523326,106.56845],[29.523326,106.56845],[29.523326,106.568471],[29.523326,106.568702],[29.523326,106.568809],[29.523353,106.569506],[29.523417,106.569834],[29.523428,106.569866],[29.523508,106.570075],[29.523605,106.570247],[29.523686,106.570386],[29.52375,106.570494],[29.523921,106.570735],[29.523965,106.570794],[29.524083,106.570971],[29.52434,106.571341],[29.524683,106.571754],[29.524941,106.571963],[29.52508,106.572071],[29.525171,106.57214],[29.525472,106.572339],[29.525547,106.572371],[29.525724,106.572398],[29.525976,106.572409],[29.526175,106.57242],[29.526556,106.572446],[29.527146,106.572478],[29.527773,106.572553],[29.528149,106.57258],[29.528798,106.572602],[29.528798,106.572602],[29.529211,106.572655],[29.529318,106.572709],[29.529345,106.572747],[29.529425,106.57309],[29.529485,106.573235],[29.529543,106.573353],[29.529651,106.573508],[29.529946,106.573836],[29.530158,106.574041],[29.530158,106.574041],[29.530278,106.574158],[29.530616,106.574469],[29.531062,106.574908],[29.53125,106.575096],[29.531705,106.575558],[29.532542,106.576411],[29.532564,106.576432],[29.533138,106.577027],[29.533567,106.577467],[29.533883,106.577757],[29.534023,106.577848],[29.534221,106.577939],[29.534538,106.578015],[29.534747,106.578031],[29.535192,106.578025],[29.535262,106.57802],[29.53552,106.578009],[29.535779,106.577995],[29.535779,106.577995],[29.536126,106.577977],[29.536399,106.577971],[29.536464,106.577988],[29.536506,106.577998],[29.536775,106.578175],[29.536839,106.578245],[29.536968,106.578481],[29.537065,106.57875],[29.537209,106.579221],[29.537354,106.579758],[29.537435,106.580101],[29.53759,106.580707],[29.537665,106.580949],[29.53781,106.581485],[29.537971,106.58207],[29.537998,106.58215],[29.538255,106.582843],[29.538459,106.583298],[29.538486,106.583373],[29.538577,106.58354],[29.538659,106.583622],[29.538659,106.583622],[29.538685,106.583647],[29.538835,106.583755],[29.539146,106.58391],[29.539376,106.584017],[29.539516,106.584082],[29.54001,106.584328],[29.540154,106.58443],[29.54024,106.584532],[29.540331,106.584715],[29.54038,106.584854],[29.540449,106.585171],[29.540455,106.585407],[29.540385,106.58597],[29.540197,106.587466],[29.540471,106.58766],[29.540701,106.587751],[29.540701,106.587751],[29.540964,106.587858],[29.541651,106.588207],[29.54208,106.588416],[29.542187,106.588448],[29.542236,106.588454],[29.542273,106.588454],[29.542375,106.588486],[29.542676,106.588529],[29.542802,106.588535],[29.542802,106.588535],[29.543089,106.58855],[29.543169,106.588556],[29.543298,106.588561],[29.543663,106.588588],[29.543716,106.588598],[29.543791,106.588636],[29.543883,106.58876],[29.543915,106.588856],[29.543926,106.588953],[29.54392,106.589333],[29.54392,106.589355],[29.543883,106.59017],[29.543877,106.590304],[29.543872,106.590417],[29.543861,106.59068],[29.543866,106.590921],[29.543926,106.591173],[29.544049,106.591393],[29.544188,106.59157],[29.544355,106.591769],[29.544569,106.592053],[29.544583,106.592068],[29.544583,106.592068],[29.54473,106.592225],[29.545417,106.592922],[29.546007,106.593255],[29.546071,106.593287],[29.546195,106.593351],[29.546479,106.593394],[29.54686,106.593475],[29.546951,106.593491],[29.547375,106.593571],[29.547471,106.593593],[29.547471,106.593593],[29.54753,106.59362],[29.547675,106.593732],[29.547917,106.593984],[29.54826,106.594371],[29.548314,106.594387],[29.548416,106.594478],[29.549124,106.594826],[29.549156,106.594843],[29.549199,106.594864],[29.549322,106.594926],[29.549322,106.594926],[29.549698,106.595116],[29.549757,106.595148],[29.54981,106.595175],[29.54981,106.595175],[29.549918,106.595266],[29.550116,106.595358],[29.550202,106.595368],[29.550325,106.595358],[29.550395,106.595336],[29.550738,106.595165],[29.550738,106.595165],[29.550921,106.595116],[29.551017,106.595111],[29.551151,106.595127],[29.551441,106.595207],[29.551618,106.595256],[29.552611,106.59562],[29.552881,106.595721],[29.552881,106.595721],[29.553099,106.595803],[29.553222,106.595851],[29.553818,106.596076],[29.553973,106.596151],[29.554096,106.596232],[29.554574,106.596597],[29.554815,106.596715],[29.555942,106.597257],[29.556033,106.5973],[29.556119,106.597343],[29.556714,106.597627],[29.557144,106.597826],[29.557144,106.597826],[29.557165,106.597836],[29.557916,106.598169],[29.558324,106.598297],[29.559091,106.598544],[29.559343,106.598614],[29.559343,106.598614],[29.560099,106.598823],[29.560475,106.598989],[29.560856,106.599172],[29.561243,106.599364],[29.561243,106.599364],[29.561467,106.599504],[29.561988,106.599864],[29.562336,106.600137],[29.562486,106.600228],[29.563409,106.600604],[29.563951,106.600819],[29.564208,106.600974],[29.56468,106.601264],[29.564766,106.601296],[29.564991,106.60135],[29.565812,106.601532],[29.565941,106.601571],[29.565941,106.601571],[29.566091,106.601618],[29.566858,106.601843],[29.567019,106.601886],[29.567561,106.602036],[29.56761,106.602052],[29.567856,106.602117],[29.567974,106.602128],[29.568167,106.602128],[29.568275,106.602111],[29.568414,106.602068],[29.568516,106.602015],[29.568784,106.601811],[29.568838,106.601747],[29.569042,106.601436],[29.569176,106.601237],[29.569455,106.600812],
                    [29.569455,106.600812],[29.569782,106.600314],[29.569814,106.600271],[29.569965,106.600116],[29.570072,106.600041],[29.570072,106.600041],[29.570158,106.599998],[29.570249,106.599976],[29.570367,106.599966],[29.570571,106.599998],[29.571177,106.600207],[29.571751,106.600443],[29.572142,106.60061],[29.572802,106.600894],[29.572856,106.600915],[29.573166,106.601052],[29.573166,106.601052],[29.573913,106.601382],[29.574181,106.601505],[29.574293,106.601532],[29.574379,106.601538],[29.574496,106.601538],[29.574496,106.601538],[29.574605,106.601538],[29.574744,106.601516],[29.574787,106.6015],[29.574841,106.601478],[29.57497,106.601403],[29.57505,106.601344],[29.575195,106.601232],[29.575458,106.601044],[29.575806,106.600786],[29.575828,106.60077],[29.576021,106.600631],[29.576359,106.600379],[29.576595,106.600245],[29.576713,106.600196],[29.576825,106.600175],[29.576859,106.600169],[29.576859,106.600169],[29.577061,106.600132],[29.5774,106.600078],[29.577464,106.600068],[29.577947,106.599993],[29.578,106.599982],[29.578419,106.599923],[29.578628,106.599853],[29.578859,106.599692],[29.579046,106.599488],[29.579143,106.599279],[29.579191,106.599129],[29.579282,106.598705],[29.579443,106.59797],[29.57961,106.597149],[29.579663,106.596924],[29.579706,106.59672],[29.579889,106.595819],[29.580028,106.595127],[29.580033,106.594993],[29.580033,106.594993],[29.58028,106.59502],[29.580516,106.595041],[29.580747,106.595041],[29.58124,106.595041],[29.581535,106.595004],[29.581991,106.594918],[29.582066,106.594902],[29.582104,106.594891],[29.582694,106.594671],[29.583402,106.594365],[29.58373,106.594253],[29.583917,106.594247],[29.584121,106.594215],[29.584459,106.594188],[29.584808,106.594215],[29.585097,106.59422],[29.585473,106.594263],[29.585741,106.594301],[29.586181,106.594408],[29.586353,106.594451],[29.586712,106.594564],[29.586991,106.594778],[29.587345,106.594977],[29.58756,106.594998],[29.587699,106.594988],[29.58845,106.594907],[29.588735,106.59487],[29.588842,106.594875],[29.589003,106.594886],[29.589721,106.59502],[29.589721,106.59502],[29.589705,106.595181],[29.58963,106.595862],[29.589657,106.595921],[29.589705,106.595948],[29.590617,106.596296],[29.590661,106.596315]
                ];
                
                // 将经纬度坐标转换为高德地图坐标格式
                var pathCoords = [];
                upLineCoords.forEach(function(coord) {
                    // 高德地图坐标格式为[经度,纬度]，而提供的数据是[纬度,经度]，需要调换顺序
                    pathCoords.push([coord[1], coord[0]]);
                });
                
                // 绘制公交线路
                var polyline = new AMap.Polyline({
                    path: pathCoords,
                    strokeColor: "#3388ff",
                    strokeWeight: 6,
                    strokeOpacity: 0.8,
                    zIndex: 50
                });
                polyline.setMap(map);
                
                // 添加站点标记
                stations.forEach(function(station) {
                    // 根据站点等级设置不同颜色
                    var color;
                    switch(station.level) {
                        case 3: color = "#e74c3c"; break; // 高效站点-红色
                        case 2: color = "#f39c12"; break; // 中效站点-黄色
                        case 1: color = "#3498db"; break; // 低效站点-蓝色
                        default: color = "#95a5a6";
                    }
                    
                    // 创建标记
                    var marker = new AMap.Marker({
                        position: station.position,
                        title: station.name,
                        icon: new AMap.Icon({
                            size: new AMap.Size(16, 16),
                            image: 'data:image/svg+xml;base64,' + btoa('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><circle cx="8" cy="8" r="7" fill="' + color + '" stroke="white" stroke-width="2"/></svg>'),
                            imageSize: new AMap.Size(16, 16)
                        }),
                        anchor: 'center'
                    });
                    
                    // 创建信息窗体 - 美化样式
                    var infoWindow = new AMap.InfoWindow({
                        isCustom: true,
                        content: createInfoWindowContent(station),
                        offset: new AMap.Pixel(0, -20),
                        autoMove: true,
                        closeWhenClickMap: true
                    });
                    
                    // 添加点击事件
                    marker.on('click', function() {
                        infoWindow.open(map, marker.getPosition());
                        showStationInfo(station);
                    });
                    
                    // 添加标签
                    var text = new AMap.Text({
                        text: station.name,
                        position: station.position,
                        offset: new AMap.Pixel(20, -10),
                        style: {
                            'background-color': 'rgba(255,255,255,0.9)',
                            'border': '1px solid #ccc',
                            'border-radius': '3px',
                            'padding': '5px',
                            'font-size': '12px',
                            'white-space': 'nowrap',
                            'box-shadow': '0 2px 6px rgba(0,0,0,0.1)'
                        }
                    });
                    
                    marker.setMap(map);
                    text.setMap(map);
                });
                
                // 添加图例
                var legendContainer = document.createElement('div');
                legendContainer.className = 'amap-legend';
                legendContainer.style.cssText = 'position: absolute; bottom: 20px; right: 20px; background: white; padding: 10px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 100;';
                legendContainer.innerHTML = `
                    <div style="margin-bottom: 5px; font-weight: bold;">站点等级</div>
                    <div style="display: flex; align-items: center; margin-bottom: 5px;">
                        <div style="width: 15px; height: 15px; background: #e74c3c; border-radius: 50%; margin-right: 5px;"></div>
                        <span>高效站点</span>
                    </div>
                    <div style="display: flex; align-items: center; margin-bottom: 5px;">
                        <div style="width: 15px; height: 15px; background: #f39c12; border-radius: 50%; margin-right: 5px;"></div>
                        <span>中效站点</span>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <div style="width: 15px; height: 15px; background: #3498db; border-radius: 50%; margin-right: 5px;"></div>
                        <span>低效站点</span>
                    </div>
                `;
                document.getElementById('mapContainer').appendChild(legendContainer);
            }
            
            // 创建信息窗体内容 - 美化样式
            function createInfoWindowContent(station) {
                var levelName = getLevelName(station.level);
                var color;
                switch(station.level) {
                    case 3: color = "#e74c3c"; break;
                    case 2: color = "#f39c12"; break;
                    case 1: color = "#3498db"; break;
                    default: color = "#95a5a6";
                }
                
                return '<div style="padding: 12px; max-width: 250px; background: white; border-radius: 6px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); border: 1px solid #ddd;">' +
                       '<h4 style="margin: 0 0 8px 0; color: ' + color + '; border-bottom: 2px solid ' + color + '; padding-bottom: 6px;">' + station.name + '</h4>' +
                       '<div style="font-size: 13px; color: #333; background: #f9f9f9; padding: 5px; border-radius: 3px; margin-bottom: 5px;">等级: <strong>' + levelName + '</strong></div>' +
                       '<div style="font-size: 13px; margin-top: 8px;">RSR值: <strong>' + station.data.RSR值.toFixed(3) + '</strong></div>' +
                       '<div style="font-size: 13px;">Probit值: <strong>' + station.data.Probit值.toFixed(2) + '</strong></div>' +
                       '<div style="font-size: 12px; margin-top: 8px; color: #666; text-align: center; background: #f5f5f5; padding: 4px; border-radius: 3px;">点击查看详细信息</div>' +
                       '</div>';
            }
            
            // 显示站点详细信息 - 美化样式
            function showStationInfo(station) {
                var infoDiv = document.getElementById("stationInfo");
                var nameElem = document.getElementById("stationName");
                var tableElem = document.getElementById("stationData");
                
                // 设置站点名称和颜色
                var color;
                switch(station.level) {
                    case 3: color = "#e74c3c"; break;
                    case 2: color = "#f39c12"; break;
                    case 1: color = "#3498db"; break;
                    default: color = "#95a5a6";
                }
                
                nameElem.textContent = station.name + " (等级: " + getLevelName(station.level) + ")";
                nameElem.style.color = color;
                nameElem.style.borderBottomColor = color;
                
                // 清空表格内容
                tableElem.innerHTML = "<tr><th style='background: #2c3e50; color: white;'>指标</th><th style='background: #2c3e50; color: white;'>数值</th></tr>";
                
                // 添加站点数据
                for (var key in station.data) {
                    var row = tableElem.insertRow();
                    var cell1 = row.insertCell(0);
                    var cell2 = row.insertCell(1);
                    cell1.textContent = key;
                    cell2.textContent = station.data[key];
                    
                    // 设置单元格样式
                    cell1.style.fontWeight = "bold";
                    cell1.style.backgroundColor = "#f5f5f5";
                    cell2.style.textAlign = "center";
                    
                    // 为特殊指标添加高亮
                    if (key === "RSR值" || key === "Probit值") {
                        cell1.style.backgroundColor = "#eaf2f8";
                        cell2.style.backgroundColor = "#eaf2f8";
                        cell2.style.fontWeight = "bold";
                        cell2.style.color = color;
                    }
                }
                
                // 显示信息区域
                infoDiv.style.display = "block";
                
                // 平滑滚动到信息区域
                infoDiv.scrollIntoView({behavior: "smooth"});
            }
            
            // 获取等级名称
            function getLevelName(level) {
                switch(level) {
                    case 3: return "高效站点";
                    case 2: return "中效站点";
                    case 1: return "低效站点";
                    default: return "未知";
                }
            }
        </script>
    </div>